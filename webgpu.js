async function init(){const e=document.createElement("canvas");if(e.id="renderCanvas",document.body.appendChild(e),!navigator.gpu)throw Error("WebGPU is not supported in this browser.");const t=await navigator.gpu.requestAdapter();if(!t)throw Error("Couldn't request WebGPU adapter.");const r=await t.requestDevice(),n=navigator.gpu.getPreferredCanvasFormat(),a=e.getContext("webgpu");a.configure({device:r,format:n});const o=new Float32Array([0,.5,-.5,0,.5,0]),i=new Float32Array([-.3,-.3,-.3,-.6,0,-.3,-.3,-.6,0,-.3,0,-.6]),u=[];for(let e=0;e<=100;e++){const t=e/100*2*Math.PI;u.push(-.8,.2),u.push(.2*Math.cos(t)-.8,.2+.2*Math.sin(t))}const s=e=>r.createBuffer({label:"Vertices",size:e.byteLength,usage:GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST}),c=s(o),f=s(i),d=s(new Float32Array(u));r.queue.writeBuffer(c,0,o),r.queue.writeBuffer(f,0,i),r.queue.writeBuffer(d,0,new Float32Array(u));const l={arrayStride:2*Float32Array.BYTES_PER_ELEMENT,attributes:[{format:"float32x2",offset:0,shaderLocation:0}]},g=r.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.FRAGMENT,buffer:{type:"uniform"}}]});function p(e,t){const r=e.createBuffer({size:16,usage:GPUBufferUsage.UNIFORM,mappedAtCreation:!0});return new Float32Array(r.getMappedRange()).set(t),r.unmap(),e.createBindGroup({layout:g,entries:[{binding:0,resource:{buffer:r}}]})}const m=p(r,[1,0,0,1]),v=p(r,[0,1,0,1]),b=p(r,[0,0,1,1]),h=r.createShaderModule({code:"\n@vertex\nfn vertexMain(@location(0) pos: vec2f) -> @builtin(position) vec4f {\n return vec4f(pos, 0.0, 1.0);\n}\n"}),y=r.createShaderModule({code:"\n@group(0) @binding(0) var<uniform> color: vec4f;\n\n@fragment\nfn fragmentMain() -> @location(0) vec4f {\n return color;\n}\n"}),w=r.createPipelineLayout({bindGroupLayouts:[g]}),B=r.createRenderPipeline({layout:w,vertex:{module:h,entryPoint:"vertexMain",buffers:[l]},fragment:{module:y,entryPoint:"fragmentMain",targets:[{format:n}]}}),P=r.createCommandEncoder(),E=P.beginRenderPass({colorAttachments:[{view:a.getCurrentTexture().createView(),clearValue:{r:0,g:56/255,b:101/255,a:1},loadOp:"clear",storeOp:"store"}]});return E.setPipeline(B),E.setBindGroup(0,m),E.setVertexBuffer(0,c),E.draw(o.length/2),E.setBindGroup(0,v),E.setVertexBuffer(0,f),E.draw(i.length/2),E.setBindGroup(0,b),E.setVertexBuffer(0,d),E.draw(u.length/2),E.end(),r.queue.submit([P.finish()]),a}init().then((e=>{console.log(e)})).catch((e=>{const t=document.createElement("p");t.innerHTML=navigator.userAgent+"</br>"+e.message,document.body.appendChild(t),document.getElementById("renderCanvas").remove()}));
